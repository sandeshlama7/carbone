version: '3'

vars:
  TERRAFORM_DIR: "terraform"

tasks:
  terraform-plan:
    desc: "Plan resource provisioning with terraform"
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform init 
      - terraform validate
      - terraform fmt
      - terraform plan -var-file=dev.tfvars

  terraform-apply:
    desc: "Provision all the resources"
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform apply -var-file=dev.tfvars -auto-approve
    depends: ['terraform-plan']

  terraform-destroy:
    desc: "Clean up all the resources"
    dir: "{{.TERRAFORM_DIR}}"
    cmds:
      - terraform destroy -var-file=dev.tfvars -auto-approve
    depends: ['terraform-plan']

  deploy:
    desc: "Provision resources"
    cmds:
      - task terraform-apply

  delete:
    desc: "Destroy resources"
    cmds:
      - task terraform-destroy
